@startuml
skinparam linetype ortho
top to bottom direction

title MicroK8s Cluster Traffic Flow with NodePort, Ingress, HPA, and DNS

actor Internet

rectangle "Local DNS Server\nresolves domain to public IP" as DNS

rectangle "FritzBox (Port Forward)\nPublic IP -> Node IP" as FritzBox

package "Cluster Nodes" {
  
  package "Node 1" {
    rectangle "Ingress Controller (Nginx)\nHandles SSL/TLS, routes traffic" as Ingress1
    [Pod 1]
    [Pod 2]
  }

  package "Node 2" {
    rectangle "Ingress Controller (Nginx)\nHandles SSL/TLS, routes traffic" as Ingress2
    [Pod 3]
  }

}

rectangle "Cluster Service (ClusterIP / NodePort)\nRoutes to pods" as Service

Internet --> DNS : Request domain (e.g., vueapp.example.com)
DNS --> FritzBox : Resolve to public IP
FritzBox --> Ingress1 : Port forward to NodePort (node with pod)
note right of FritzBox
Traffic goes to **one node only** depending on pod location
end note

Ingress1 --> Service : Route by host/path
Service --> [Pod 1]
Service --> [Pod 2]

note right of Service
Service load-balances only **among pods on the same node** for NodePort
HPA scales pods up/down
end note

note left of Ingress1
Ingress could also be scaled, but NodePort routing limits traffic
to node where pod is scheduled
end note

@enduml
